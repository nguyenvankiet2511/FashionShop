<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <title>Cosmic Store</title>
    <link rel="icon" type="image/png" href="static/images/icons/favicon.png"/>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Colo Shop Template">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap4/bootstrap.min.css') }}">
    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static', filename='plugins/font-awesome-4.7.0/css/font-awesome.min.css') }}">
    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static', filename='plugins/OwlCarousel2-2.2.1/owl.carousel.css') }}">
    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static', filename='plugins/OwlCarousel2-2.2.1/owl.theme.default.css') }}">
    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static', filename='plugins/OwlCarousel2-2.2.1/animate.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/checkout.css') }}">

</head>

<body>

<div class="super_container">

    <!-- Header -->

    <header class="header trans_300">

        <!-- Top Navigation -->

        <div class="top_nav">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <div class="top_nav_left"></div>
                    </div>
                    <div class="col-md-6 text-right">
                        <div class="top_nav_right">
                            <ul class="top_nav_menu">

                                <!-- Currency / Language / My Account -->

                                <li class="currency">
                                    <a href="#">
                                        usd
                                        <i class="fa fa-angle-down"></i>
                                    </a>
                                    <ul class="currency_selection">
                                        <li><a href="#">cad</a></li>
                                        <li><a href="#">aud</a></li>
                                        <li><a href="#">eur</a></li>
                                        <li><a href="#">gbp</a></li>
                                    </ul>
                                </li>
                                <li class="language">
                                    <a href="#">
                                        English
                                        <i class="fa fa-angle-down"></i>
                                    </a>
                                    <ul class="language_selection">
                                        <li><a href="#">French</a></li>
                                        <li><a href="#">Italian</a></li>
                                        <li><a href="#">German</a></li>
                                        <li><a href="#">Spanish</a></li>
                                    </ul>
                                </li>
                                <li class="account">
                                    <a href="#">
                                        My Account
                                        <i class="fa fa-angle-down"></i>
                                    </a>
                                    {% if user is none %}
                                    <ul class="account_selection">
                                        <li><a href="{{url_for('show_login')}}"><i class="fa fa-sign-in"
                                                                                   aria-hidden="true"></i>Sign In</a>
                                        </li>
                                        <li><a href="{{url_for('show_login')}}"><i class="fa fa-user-plus"
                                                                                   aria-hidden="true"></i>Register</a>
                                        </li>
                                    </ul>
                                    {% else %}
                                    <ul class="account_selection">

                                        <li><a href="{{url_for('view_profile')}}"><i class="fa fa-sign-in"


                                                                                     aria-hidden="true"></i>Profile</a>
                                        </li>
                                        <li><a href="{{url_for('user_logout')}}"><i class="fa fa-user-plus"
                                                                                    aria-hidden="true"></i>Logout</a>
                                        </li>
                                    </ul>
                                    {% endif %}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Navigation -->

        <div class="main_nav_container">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 text-right">
                        <div class="logo_container">
                            <a href="{{url_for('home')}}">Cosmic<span>Store</span></a>
                        </div>
                        <nav class="navbar">
                            <ul class="navbar_menu">
                                <li><a href="{{url_for('home')}}">home</a></li>
                                <li><a href="{{url_for('view_categories')}}">shop</a></li>
                                <li><a href="#">promotion</a></li>
                                    <li><a href="{{url_for('view_history_order')}}">History</a></li>

                                <li><a href="{{url_for('view_blog')}}">blog</a></li>
                                <li><a href="{{url_for('view_contact')}}">contact</a></li>


                            </ul>
                            <ul class="navbar_user">
                                <li class="search-container">
                                    <a href="#" id="search-icon">
                                        <i class="fa fa-search" aria-hidden="true"></i>
                                    </a>
                                    <div class="search-box" id="search-box">
                                        <input type="text" placeholder="Search...">
                                        <button type="button" id="search-btn">Search</button>
                                    </div>
                                </li>
                                {% if user %}
                                <li class="user-menu">

                                    <a href="{{url_for('view_profile')}}">


                                        <i class="fa fa-user" aria-hidden="true"></i>
                                        <span class="user-text">{{user.name}}</span>
                                    </a>
                                </li>
                                {% else %}
                                <li class="user-menu">
                                    <a href="{{url_for('show_login')}}">
                                        <i class="fa fa-user" aria-hidden="true"></i>
                                        <span class="user-text">Đăng nhập</span>
                                    </a>
                                </li>
                                {% endif %}

                                <li class="checkout">
                                    <a href="cart.html">
                                        <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                                        {% if countCart %}
                                        <span id="checkout_items" class="checkout_items">{{countCart}}</span>
                                        {% endif %}
                                    </a>
                                </li>
                            </ul>
                            <div class="hamburger_container">
                                <i class="fa fa-bars" aria-hidden="true"></i>
                            </div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>

    </header>

    <div class="fs_menu_overlay"></div>
    <div class="hamburger_menu">
        <div class="hamburger_close"><i class="fa fa-times" aria-hidden="true"></i></div>
        <div class="hamburger_menu_content text-right">
            <ul class="menu_top_nav">
                <li class="menu_item has-children">
                    <a href="#">
                        usd
                        <i class="fa fa-angle-down"></i>
                    </a>
                    <ul class="menu_selection">
                        <li><a href="#">cad</a></li>
                        <li><a href="#">aud</a></li>
                        <li><a href="#">eur</a></li>
                        <li><a href="#">gbp</a></li>
                    </ul>
                </li>
                <li class="menu_item has-children">
                    <a href="#">
                        English
                        <i class="fa fa-angle-down"></i>
                    </a>
                    <ul class="menu_selection">
                        <li><a href="#">French</a></li>
                        <li><a href="#">Italian</a></li>
                        <li><a href="#">German</a></li>
                        <li><a href="#">Spanish</a></li>
                    </ul>
                </li>
                <li class="menu_item has-children">
                    <a href="#">
                        My Account
                        <i class="fa fa-angle-down"></i>
                    </a>
                    {% if user is none %}
                    <ul class="account_selection">
                        <li><a href="{{url_for('show_login')}}"><i class="fa fa-sign-in" aria-hidden="true"></i>Sign In</a>
                        </li>
                        <li><a href="{{url_for('show_login')}}"><i class="fa fa-user-plus" aria-hidden="true"></i>Register</a>
                        </li>
                    </ul>
                    {% else %}
                    <ul class="account_selection">

                        <li><a href="{{url_for('view_profile')}}"><i class="fa fa-sign-in" aria-hidden="true"></i>Profile</a>


                        </li>
                        <li><a href="{{url_for('user_logout')}}"><i class="fa fa-user-plus" aria-hidden="true"></i>Logout</a>
                        </li>
                    </ul>
                    {% endif %}
                </li>
                <li class="menu_item"><a href="{{url_for('home')}}">home</a></li>
                <li class="menu_item"><a href="{{url_for('view_categories')}}">shop</a></li>
                <li class="menu_item"><a href="#">promotion</a></li>
                <li class="menu_item"><a href="#">pages</a></li>

                <li class="menu_item"><a href="{{url_for('view_blog')}}">blog</a></li>
                <li class="menu_item"><a href="{{url_for('view_contact')}}">contact</a></li>


            </ul>
        </div>
    </div>

    <div class="checkout-container" style="margin-top: 160px;">
        <!-- Phần 1: Thông tin địa chỉ -->
        <div class="address-info">
            <h3>Thông tin địa chỉ</h3>
            <form>
                <div class="form-row">
                    <div class="form-col-6">
                        <label for="firstname">Họ</label>
                        <input type="text" id="firstname" name="firstname" placeholder="">
                    </div>
                    <div class="form-col-6">
                        <label for="lastname">Tên</label>
                        <input type="text" id="lastname" name="lastname" placeholder="">
                    </div>
                    <div class="form-col-12">
                        <label for="country">Nơi sống</label>
                        <select id="country" name="country">
                            <option value="" disabled selected hidden>Chọn quốc gia</option>
                            <option value="VietNam">Việt Nam</option>
                            <option value="France">France</option>
                            <option value="Italy">Italy</option>
                            <option value="Philippines">Philippines</option>
                            <option value="South Korea">South Korea</option>
                            <option value="Hongkong">Hongkong</option>
                            <option value="Japan">Japan</option>
                        </select>
                    </div>
                    <div class="form-col-6">
                        <label for="address">Địa chỉ nhận hàng</label>
                        <input type="text" id="address" name="address" placeholder="House number and street name">
                    </div>
                    <div class="form-col-6">
                        <label for="city">Thành phố</label>
                        <input type="text" id="city" name="city" placeholder="">
                    </div>
                    <div class="form-col-6">
                        <label for="zipcode">Mã ZIP</label>
                        <input type="text" id="zipcode" name="zipcode" placeholder="">
                    </div>
                    <div class="form-col-6">
                        <label for="phone">Số điện thoại</label>
                        <input type="text" id="phone" name="phone" placeholder="">
                    </div>
                    <div class="form-col-12">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" placeholder="">
                    </div>
                    <div class="form-col-3">
                        <p>
                            <button type="submit" class="checkout-button">Tạo địa chỉ</button>
                        </p>
                    </div>
                </div>
            </form>
        </div>
        {% for cart in l_cartId %}
        <input type="hidden" class="cart_id" value="{{ cart }}">
        {% endfor %}


        <div class="address-info" style="margin-top: 35px;">
            <h3>Thông tin địa chỉ</h3>
            <form id="address-form">
                <div class="form-row">
                    <div class="form-col-12">
                        <label for="address">Chọn địa chỉ:</label>
                        <select id="address-select" name="address">
                            <option value="">--Chọn địa chỉ--</option>
                            {% for address in l_address %}
                            <option value="{{address.id}}">{{address.name}} - {{address.phone}} -
                                {{address.addressDetail}}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </form>
        </div>


        <!-- Phần 2: Tổng đơn hàng và Phương thức thanh toán -->

        <div class="order-summary">
            <div class="summary-row">
                <div class="summary-col-6">
                    <div class="order-detail">
                        <h3>Tổng đơn hàng</h3>
                        <p>
                            <span>Tổng cộng</span>
                            <span id="subtotal">{{subtotal}} VND</span>
                        </p>
                        <p>
                            <span>Phí vận chuyển</span>
                            <span id="tax">{{tax}} VND</span>
                        </p>
                        <p>
                            <span>Giảm giá</span>
                            <span>10.00%</span>
                        </p>
                        <p>
                            <span>Số lượng mặt hàng</span>
                            <span id="item-count">3</span>
                        </p>
                        <hr/>
                        <p class="total-amount">
                            <span>Thành tiền</span>
                            <span id="total">{{total}} VND</span>
                        </p>
                    </div>
                </div>

                <div class="summary-col-6">
                    <div class="payment-method">
                        <h3>Phương thức thanh toán</h3>
                        <div class="payment-option">
                            <label>
                                <input type="radio" name="payment" value="cod"/> Thanh toán khi nhận hàng
                            </label>
                        </div>
                        <div class="payment-option">
                            <label>
                                <input type="radio" name="payment" value="check"/> Check Payment
                            </label>
                        </div>
                        <div class="payment-option">
                            <label>
                                <input type="radio" name="payment" value="vnpay"/> VNPAY
                            </label>
                        </div>
                        <div class="terms-conditions">
                            <label>
                                <input type="checkbox" id="terms-conditions"/> Tôi đã đọc và chấp nhận các điều khoản và
                                điều kiện
                            </label>
                        </div>
                        <p>
                            <button type="submit" id="checkout-button" class="checkout-button">Thanh toán</button>
                        </p>
                    </div>
                </div>
            </div>
        </div>


        <!-- Newsletter -->

        <!-- Footer Section End -->

    </div>


    <div class="newsletter">
        <div class="container">
            <div class="row">
                <div class="col-lg-6">
                    <div class="newsletter_text d-flex flex-column justify-content-center align-items-lg-start align-items-md-center text-center">
                        <h4>Bản Tin</h4>
                        <p>Đăng ký nhận bản tin chúng tôi được giảm 20% lần mua đầu tiên</p>
                    </div>
                </div>
                <div class="col-lg-6">
                    <form action="post">
                        <div class="newsletter_form d-flex flex-md-row flex-column flex-xs-column align-items-center justify-content-lg-end justify-content-center">
                            <input id="newsletter_email" type="email" placeholder="Email của bạn" required="required"
                                   data-error="Yêu cầu email hợp lệ.">
                            <button id="newsletter_submit" type="submit" class="newsletter_submit_btn trans_300"
                                    value="Submit">đăng ký
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="footer__about">
                        <p>Chúng tôi ưu tiên tạo ra trải nghiệm mua sắm cá nhân hóa cho từng khách hàng, đảm bảo rằng
                            mỗi lần ghé thăm đều cảm thấy độc đáo và đặc biệt.</p>
                        <i>Địa chỉ: <a href="index.html">shoppingnow@gmail.com</a></i>
                        <a href="#"><img src="{{ url_for('static', filename='images/icons/payment.png') }}"
                                         alt="Phương thức thanh toán"></a>
                    </div>
                </div>
                <div class="col-lg-2 offset-lg-1 col-md-3 col-sm-6">
                    <div class="footer__widget">
                        <h6>Mua sắm</h6>
                        <ul>
                            <li><a href="#">Cửa hàng quần áo</a></li>
                            <li><a href="#">Giày dép thịnh hành</a></li>
                            <li><a href="#">Phụ kiện</a></li>
                            <li><a href="#">Khuyến mãi</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6">
                    <div class="footer__widget">
                        <h6>Dịch vụ khách hàng</h6>
                        <ul>
                            <li><a href="#">Liên hệ chúng tôi</a></li>
                            <li><a href="#">Phương thức thanh toán</a></li>
                            <li><a href="#">Giao hàng</a></li>
                            <li><a href="#">Đổi trả hàng</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 offset-lg-1 col-md-6 col-sm-6">
                    <div class="footer__widget">
                        <h6>Bản tin</h6>
                        <div class="footer__newslatter">
                            <p>Hãy là người đầu tiên biết về sản phẩm mới, bộ sưu tập, giảm giá & chương trình khuyến
                                mãi!</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="footer__copyright__text">
                        <p>Chào mừng bạn đến với trang mua sắm của chúng tôi
                            <script>
                                document.write(new Date().getFullYear());
                            </script>
                            <i class="fa fa-heart-o" aria-hidden="true"></i> bởi <a href="index.html" target="_blank">Cosmic
                                Store</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/jquery-3.2.1.min.js') }}"></script>
    <script src="{{ url_for('static', filename='css/bootstrap4/popper.js') }}"></script>
    <script src="{{ url_for('static', filename='css/bootstrap4/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/Isotope/isotope.pkgd.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/OwlCarousel2-2.2.1/owl.carousel.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/easing/easing.js') }}"></script>
    <script src="{{ url_for('static', filename='js/carts.js') }}"></script>
    <script>
        document.getElementById('checkout-button').addEventListener('click', function(event) {
        // Ngăn chặn hành vi mặc định của nút
        event.preventDefault();

        // Lấy giá trị của các phương thức thanh toán
        const paymentOptions = document.querySelectorAll('input[name="payment"]');
        let selectedPaymentMethod = null;
        const addressSelect = document.getElementById('address-select');
        const selectedAddress = addressSelect.value;

        // Kiểm tra xem người dùng đã chọn địa chỉ chưa
        if (!selectedAddress) {
            alert('Vui lòng chọn địa chỉ.');
            return;
        }

        // Kiểm tra xem phương thức thanh toán đã được chọn chưa
        paymentOptions.forEach(option => {
            if (option.checked) {
                selectedPaymentMethod = option.value;
            }
        });

        if (!selectedPaymentMethod) {
            alert('Vui lòng chọn phương thức thanh toán.');
            return;
        }

        // Kiểm tra xem người dùng đã chấp nhận các điều khoản và điều kiện chưa
        const termsChecked = document.getElementById('terms-conditions').checked;

        if (!termsChecked) {
            alert('Vui lòng chấp nhận các điều khoản và điều kiện.');
            return;
        }

        // Lấy dữ liệu từ HTML
        const subtotal = document.getElementById('subtotal').innerText.split(' ')[0].replace(',', '');
        const tax = document.getElementById('tax').innerText.split(' ')[0].replace(',', '');
        const total = document.getElementById('total').innerText.split(' ')[0].replace(',', '');
        const itemCount = document.getElementById('item-count').innerText;



        // Lấy danh sách ID giỏ hàng
        const cartIds = Array.from(document.querySelectorAll('.cart_id')).map(input => input.value);



        // Thay thế giá trị giả bằng giá trị thực tế
        const cartData = cartIds; // Dữ liệu giỏ hàng

        // Xử lý các tình huống theo phương thức thanh toán đã chọn
        switch (selectedPaymentMethod) {
            case 'cod':
                // Phương thức thanh toán khi nhận hàng
                alert('Bạn đã chọn thanh toán khi nhận hàng.');

                // Gửi dữ liệu đến server
                fetch('http://localhost:5001/confirm-checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        address_id: selectedAddress,
                        total: total,
                        paymentMethod: selectedPaymentMethod,
                        l_cart: cartData,
                        item_count: itemCount
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => {
                            throw new Error(`HTTP error! status: ${response.status}, ${text}`);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                   window.location.href = 'http://localhost:5001/success-order';
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Có thể xử lý lỗi tại đây
                });
                break;

            case 'check':
                // Phương thức thanh toán bằng séc
                alert('Bạn đã chọn thanh toán bằng séc.');
                // Xử lý cho thanh toán bằng séc ở đây
                break;

            case 'vnpay':
                // Phương thức thanh toán qua VNPAY
                alert('Bạn đã chọn thanh toán qua VNPAY.');
                // Xử lý cho thanh toán qua VNPAY ở đây
                break;

            default:
                alert('Phương thức thanh toán không hợp lệ.');
                break;
        }
    });


    </script>
</body>

</html>
